<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† ğŸ”</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
        
        /* ================= Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ================= */
        #login-section {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #2c3e50, #4ca1af);
        }
        .login-card {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 350px;
            text-align: center;
        }
        .login-card h2 { color: #2c3e50; margin-bottom: 20px; }
        .login-icon { font-size: 50px; margin-bottom: 10px; display: block; }
        
        input {
            width: 100%; padding: 12px; margin: 10px 0;
            border: 1px solid #ddd; border-radius: 8px;
            box-sizing: border-box; text-align: center; font-family: inherit;
        }
        button.login-btn {
            width: 100%; padding: 12px; background: #2c3e50; color: white;
            border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem;
            transition: 0.3s;
        }
        button.login-btn:hover { background: #34495e; }
        
        /* ================= Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ù…Ø®ÙÙŠØ©) ================= */
        #dashboard-section {
            display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© */
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card h2 { margin-top: 0; color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 10px; font-size: 1.2rem; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; color: #555; font-weight: bold; }
        
        .btn-delete { background: #ff7675; color: white; border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; }
        .btn-logout { background: #e74c3c; color: white; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; margin-bottom: 20px; }

        .stat-box { display: flex; gap: 15px; margin-bottom: 20px; }
        .stat { background: #3498db; color: white; padding: 15px; flex: 1; border-radius: 10px; text-align: center; }
        .stat span { display: block; font-size: 2rem; font-weight: bold; }
    </style>
</head>
<body>

    <section id="login-section">
        <div class="login-card">
            <span class="login-icon">ğŸ‘®â€â™‚ï¸</span>
            <h2>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
            <div id="error-msg" style="color:red; font-size:0.9rem; display:none; margin-bottom:10px;"></div>
            <input type="email" id="admin-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©">
            <input type="password" id="admin-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="login-btn" id="btn-login-action">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <a href="index.html" style="display:block; margin-top:15px; color:#777; font-size:0.8rem; text-decoration:none">Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</a>
        </div>
    </section>

    <section id="dashboard-section">
        <div style="display:flex; justify-content:space-between; align-items:center">
            <button class="btn-logout" id="btn-logout-action">ğŸ”“ Ø®Ø±ÙˆØ¬</button>
            <span>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù‚Ø§Ø¦Ø¯ ğŸ‘‹</span>
        </div>

        <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h1>

        <div class="stat-box">
            <div class="stat">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†<span id="user-count">0</span></div>
            <div class="stat" style="background:#27ae60">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„<span id="msg-count">0</span></div>
            <div class="stat" style="background:#f39c12">Ø§Ù„Ø·Ù„Ø¨Ø§Øª<span id="req-count">0</span></div>
        </div>

        <div class="card">
            <h2>ğŸ“ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <table>
                <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø³Ø¨Ø¨</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                <tbody id="requests-table"><tr><td colspan="4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody>
            </table>
        </div>

        <div class="card">
            <h2>ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†</h2>
            <table>
                <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th><th>ID</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                <tbody id="users-table"><tr><td colspan="4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody>
            </table>
        </div>

        <div class="card">
            <h2>ğŸ“¢ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù…</h2>
            <table>
                <thead><tr><th>Ø§Ù„Ù…Ø±Ø³Ù„</th><th>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                <tbody id="msgs-table"><tr><td colspan="4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr></tbody>
            </table>
        </div>
    </section>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
  apiKey: "AIzaSyCjclCgnbj-dIfLWsCV39ytLvHmMwX9Oj8",
  authDomain: "myweeklyschedule-7f3da.firebaseapp.com",
  databaseURL: "https://myweeklyschedule-7f3da-default-rtdb.firebaseio.com",
  projectId: "myweeklyschedule-7f3da",
  storageBucket: "myweeklyschedule-7f3da.firebasestorage.app",
  messagingSenderId: "752443312256",
  appId: "1:752443312256:web:954239c4c12b1d8f92fe65"
};

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // ğŸ‘‡ğŸ‘‡ Ø¶Ø¹ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„ÙˆØ­ÙŠØ¯ Ù‡Ù†Ø§ ğŸ‘‡ğŸ‘‡
        const ALLOWED_ADMIN = "owaies@user.com"; 

        // ================= Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ =================
        
        // 1. Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('btn-login-action').addEventListener('click', () => {
            const e = document.getElementById('admin-email').value;
            const p = document.getElementById('admin-pass').value;
            const errDiv = document.getElementById('error-msg');

            // ØªØ­Ù‚Ù‚ Ø¨Ø³ÙŠØ· Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³ÙŠØ±ÙØ±
            if(e !== ALLOWED_ADMIN) {
                errDiv.innerText = "â›” Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ù‡ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù†";
                errDiv.style.display = 'block';
                return;
            }

            signInWithEmailAndPassword(auth, e, p)
            .then(() => {
                // Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­ØŒ Ø³ÙŠÙ‚ÙˆÙ… onAuthStateChanged Ø¨Ø§Ù„Ø¨Ø§Ù‚ÙŠ
                errDiv.style.display = 'none';
            })
            .catch((error) => {
                errDiv.innerText = "Ø®Ø·Ø£ ÙÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯";
                errDiv.style.display = 'block';
            });
        });

        // 2. Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
        document.getElementById('btn-logout-action').addEventListener('click', () => {
            signOut(auth);
        });

        // 3. Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø°ÙƒÙŠ (Switch)
        onAuthStateChanged(auth, (user) => {
            const loginSec = document.getElementById('login-section');
            const dashSec = document.getElementById('dashboard-section');

            if (user) {
                if (user.email === ALLOWED_ADMIN) {
                    // âœ… Ù‡Ùˆ Ø§Ù„Ø£Ø¯Ù…Ù†: Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„ÙˆØ­Ø©
                    loginSec.style.display = 'none';
                    dashSec.style.display = 'block';
                    loadAllData(); // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                } else {
                    // â›” Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: Ø·Ø±Ø¯Ù‡
                    alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¹Ø§Ù… ÙÙ‚Ø·.");
                    signOut(auth); // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ù‡ ÙÙˆØ±Ø§Ù‹
                }
            } else {
                // ğŸ”’ ØºÙŠØ± Ù…Ø³Ø¬Ù„: Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙ‚Ø·
                loginSec.style.display = 'flex';
                dashSec.style.display = 'none';
            }
        });

        // ================= Ø¯ÙˆØ§Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =================
        function loadAllData() {
            // 1. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            onValue(ref(db, 'users'), (snap) => {
                const table = document.getElementById('users-table');
                table.innerHTML = '';
                const data = snap.val();
                if(data) {
                    document.getElementById('user-count').innerText = Object.keys(data).length;
                    Object.values(data).forEach(u => {
                        table.innerHTML += `<tr><td>${u.name}</td><td>${u.email}</td><td style="font-size:0.7rem">${u.uid}</td><td><button class="btn-delete" onclick="window.del('users/${u.uid}')">Ø­Ø°Ù</button></td></tr>`;
                    });
                } else table.innerHTML = '<tr><td colspan="4">Ù„Ø§ ÙŠÙˆØ¬Ø¯</td></tr>';
            });

            // 2. Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            onValue(ref(db, 'public_chat_messages'), (snap) => {
                const table = document.getElementById('msgs-table');
                table.innerHTML = '';
                const data = snap.val();
                if(data) {
                    const arr = Object.entries(data).reverse();
                    document.getElementById('msg-count').innerText = arr.length;
                    arr.forEach(([k, v]) => {
                        const txt = v.image ? 'ğŸ“· ØµÙˆØ±Ø©' : v.text;
                        table.innerHTML += `<tr><td>${v.senderName}</td><td>${txt}</td><td>${v.time}</td><td><button class="btn-delete" onclick="window.del('public_chat_messages/${k}')">Ø­Ø°Ù</button></td></tr>`;
                    });
                } else table.innerHTML = '<tr><td colspan="4">Ù„Ø§ ÙŠÙˆØ¬Ø¯</td></tr>';
            });

            // 3. Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            onValue(ref(db, 'account_requests'), (snap) => {
                const table = document.getElementById('requests-table');
                table.innerHTML = '';
                const data = snap.val();
                if(data) {
                    document.getElementById('req-count').innerText = Object.keys(data).length;
                    Object.entries(data).forEach(([k, v]) => {
                        table.innerHTML += `<tr><td>${v.name}</td><td>${v.reason}</td><td>${v.date||'-'}</td><td><button class="btn-delete" onclick="window.del('account_requests/${k}')">Ø­Ø°Ù</button></td></tr>`;
                    });
                } else {
                    document.getElementById('req-count').innerText = "0";
                    table.innerHTML = '<tr><td colspan="4">Ù„Ø§ ÙŠÙˆØ¬Ø¯</td></tr>';
                }
            });
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø¹Ø§Ù…Ø©
        window.del = (path) => {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) remove(ref(db, path));
        };

    </script>
</body>
</html>