<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† ğŸ‘®â€â™‚ï¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f4f6f9; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        h1 { color: #2c3e50; text-align: center; }
        
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .card h2 { margin-top: 0; color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 10px; display: inline-block; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; color: #333; font-weight: bold; }
        tr:hover { background-color: #f1f1f1; }
        
        .btn-delete { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .btn-delete:hover { background: #c0392b; }
        
        .stat-box { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat { background: #3498db; color: white; padding: 20px; flex: 1; border-radius: 10px; text-align: center; font-size: 1.2rem; }
        .stat span { display: block; font-size: 2.5rem; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ‘®â€â™‚ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>

        <div class="stat-box">
            <div class="stat">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†<span id="user-count">0</span></div>
            <div class="stat" style="background:#27ae60">Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù…<span id="msg-count">0</span></div>
        </div>

        <div class="card">
            <h2>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                        <th>User ID (UID)</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="users-table">
                    <tr><td colspan="4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>ğŸ“¢ Ø¢Ø®Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø±Ø³Ù„</th>
                        <th>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                        <th>Ø§Ù„ÙˆÙ‚Øª</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="msgs-table">
                    <tr><td colspan="4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
		const firebaseConfig = {
  apiKey: "AIzaSyC12wP3jPuylQzJe2HNaiDFJgNSMf50jaI",
  authDomain: "steps4u-aea0c.firebaseapp.com",
  databaseURL: "https://steps4u-aea0c-default-rtdb.firebaseio.com",
  projectId: "steps4u-aea0c",
  storageBucket: "steps4u-aea0c.firebasestorage.app",
  messagingSenderId: "316135301602",
  appId: "1:316135301602:web:2f9a119f50093e8ac899bb",
  measurementId: "G-S27FV5E84B"
};

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 1. Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        const usersRef = ref(db, 'users');
        onValue(usersRef, (snapshot) => {
            const table = document.getElementById('users-table');
            const data = snapshot.val();
            table.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„

            if (data) {
                document.getElementById('user-count').innerText = Object.keys(data).length;
                Object.values(data).forEach(user => {
                    const row = `
                        <tr>
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td style="font-family:monospace; font-size:0.8rem">${user.uid}</td>
                            <td><button class="btn-delete" onclick="deleteUser('${user.uid}')">Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button></td>
                        </tr>
                    `;
                    table.innerHTML += row;
                });
            } else {
                table.innerHTML = '<tr><td colspan="4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</td></tr>';
            }
        });

        // 2. Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø©
        const chatRef = ref(db, 'public_chat_messages');
        onValue(chatRef, (snapshot) => {
            const table = document.getElementById('msgs-table');
            const data = snapshot.val();
            table.innerHTML = '';

            if (data) {
                const msgs = Object.entries(data).reverse(); // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
                document.getElementById('msg-count').innerText = msgs.length;

                msgs.forEach(([key, msg]) => {
                    const content = msg.image ? 'ğŸ“· [ØµÙˆØ±Ø©]' : msg.text;
                    const row = `
                        <tr>
                            <td>${msg.senderName}</td>
                            <td>${content}</td>
                            <td>${msg.time}</td>
                            <td><button class="btn-delete" onclick="deleteMsg('${key}')">Ø­Ø°Ù</button></td>
                        </tr>
                    `;
                    table.innerHTML += row;
                });
            } else {
                table.innerHTML = '<tr><td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</td></tr>';
            }
        });

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø°Ù (ÙŠØ¬Ø¨ Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù€ window)
        window.deleteUser = (uid) => {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø´Ø§Øª.')) {
                remove(ref(db, 'users/' + uid));
                // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ ÙŠØ­Ø°Ù Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙ‚Ø·ØŒ Ù„ØªØ¹Ø·ÙŠÙ„ Ø¯Ø®ÙˆÙ„Ù‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ø§Ø³ØªØ®Ø¯Ù… Firebase Console -> Authentication
            }
        };

        window.deleteMsg = (key) => {
            if(confirm('Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) {
                remove(ref(db, 'public_chat_messages/' + key));
            }
        };

    </script>
</body>
</html>