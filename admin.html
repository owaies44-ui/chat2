<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      const firebaseConfig = {
  apiKey: "AIzaSyCjclCgnbj-dIfLWsCV39ytLvHmMwX9Oj8",
  authDomain: "myweeklyschedule-7f3da.firebaseapp.com",
  databaseURL: "https://myweeklyschedule-7f3da-default-rtdb.firebaseio.com",
  projectId: "myweeklyschedule-7f3da",
  storageBucket: "myweeklyschedule-7f3da.firebasestorage.app",
  messagingSenderId: "752443312256",
  appId: "1:752443312256:web:954239c4c12b1d8f92fe65"
};

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // ğŸ” Ø£Ù‡Ù… Ø¬Ø²Ø¡: Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠØªØ£ÙƒØ¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ø£Ù†Ùƒ Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ -> Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                console.log("Logged in as: ", user.email);
                loadUsers();
                loadMessages();
            } else {
                // ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ -> ØªØ­Ø°ÙŠØ± ÙˆØ¥Ø¹Ø§Ø¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                alert("ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©!");
                window.location.href = "index.html"; 
            }
        });

        // 1. Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function loadUsers() {
            const usersRef = ref(db, 'users');
            onValue(usersRef, (snapshot) => {
                const table = document.getElementById('users-table');
                const data = snapshot.val();
                table.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„

                if (data) {
                    document.getElementById('user-count').innerText = Object.keys(data).length;
                    Object.values(data).forEach(user => {
                        const row = `
                            <tr>
                                <td>${user.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</td>
                                <td>${user.email}</td>
                                <td style="font-family:monospace; font-size:0.8rem">${user.uid}</td>
                                <td><button class="btn-delete" onclick="window.deleteUser('${user.uid}')">Ø­Ø°Ù</button></td>
                            </tr>
                        `;
                        table.innerHTML += row;
                    });
                } else {
                    table.innerHTML = '<tr><td colspan="4" style="text-align:center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</td></tr>';
                }
            }, (error) => {
                console.error("Error loading users:", error);
                alert("Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: " + error.message);
            });
        }

        // 2. Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ù…Ø©
        function loadMessages() {
            const chatRef = ref(db, 'public_chat_messages');
            onValue(chatRef, (snapshot) => {
                const table = document.getElementById('msgs-table');
                const data = snapshot.val();
                table.innerHTML = '';

                if (data) {
                    const msgs = Object.entries(data).reverse(); // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
                    document.getElementById('msg-count').innerText = msgs.length;

                    msgs.forEach(([key, msg]) => {
                        const content = msg.image ? 'ğŸ“· [ØµÙˆØ±Ø©]' : msg.text;
                        const row = `
                            <tr>
                                <td>${msg.senderName || 'Ù…Ø¬Ù‡ÙˆÙ„'}</td>
                                <td>${content}</td>
                                <td>${msg.time}</td>
                                <td><button class="btn-delete" onclick="window.deleteMsg('${key}')">Ø­Ø°Ù</button></td>
                            </tr>
                        `;
                        table.innerHTML += row;
                    });
                } else {
                    table.innerHTML = '<tr><td colspan="4" style="text-align:center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</td></tr>';
                }
            });
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø°Ù (Ù…Ø±Ø¨ÙˆØ·Ø© Ø¨Ø§Ù„Ù†Ø§ÙØ°Ø© Ù…Ø¨Ø§Ø´Ø±Ø©)
        window.deleteUser = (uid) => {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŸ')) {
                remove(ref(db, 'users/' + uid))
                .then(() => alert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­"))
                .catch(err => alert("Ø®Ø·Ø£: " + err.message));
            }
        };

        window.deleteMsg = (key) => {
            if(confirm('Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) {
                remove(ref(db, 'public_chat_messages/' + key));
            }
        };

    </script>