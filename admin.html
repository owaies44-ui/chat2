<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† ğŸ‘®â€â™‚ï¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f4f6f9; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; display: none; /* Ù…Ø®ÙÙŠ Ø­ØªÙ‰ Ø§Ù„ØªØ­Ù‚Ù‚ */ }
        
        h1 { color: #2c3e50; text-align: center; }
        
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .card h2 { margin-top: 0; color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 10px; display: inline-block; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; color: #333; font-weight: bold; }
        tr:hover { background-color: #f1f1f1; }
        
        .btn-delete { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .btn-delete:hover { background: #c0392b; }
        
        .stat-box { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat { background: #3498db; color: white; padding: 20px; flex: 1; border-radius: 10px; text-align: center; font-size: 1.2rem; }
        .stat span { display: block; font-size: 2.5rem; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container" id="admin-content">
        <h1>ğŸ‘®â€â™‚ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>

        <div class="stat-box">
            <div class="stat">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†<span id="user-count">0</span></div>
            <div class="stat" style="background:#27ae60">Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù…<span id="msg-count">0</span></div>
        </div>
        
        <div class="card">
            <h2 style="border-color:orange; color:orange">ğŸ“ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
                        <th>Ø§Ù„Ø³Ø¨Ø¨</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody id="requests-table">
                    <tr><td colspan="5">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</td></tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                        <th>User ID</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="users-table">
                    <tr><td colspan="4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>ğŸ“¢ Ø¢Ø®Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø±Ø³Ù„</th>
                        <th>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                        <th>Ø§Ù„ÙˆÙ‚Øª</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="msgs-table">
                    <tr><td colspan="4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
  apiKey: "AIzaSyCjclCgnbj-dIfLWsCV39ytLvHmMwX9Oj8",
  authDomain: "myweeklyschedule-7f3da.firebaseapp.com",
  databaseURL: "https://myweeklyschedule-7f3da-default-rtdb.firebaseio.com",
  projectId: "myweeklyschedule-7f3da",
  storageBucket: "myweeklyschedule-7f3da.firebasestorage.app",
  messagingSenderId: "752443312256",
  appId: "1:752443312256:web:954239c4c12b1d8f92fe65"
};
        // ===========================================

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // ğŸ‘‡ğŸ‘‡ Ø¶Ø¹ Ø¥ÙŠÙ…ÙŠÙ„Ùƒ Ù‡Ù†Ø§ (Ø§Ù„Ø´Ø®Øµ Ø§Ù„ÙˆØ­ÙŠØ¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡) ğŸ‘‡ğŸ‘‡
        const ALLOWED_ADMIN = "owaies@user.com"; 

        onAuthStateChanged(auth, (user) => {
            if (user && user.email === ALLOWED_ADMIN) {
                // âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
                document.getElementById('admin-content').style.display = 'block';
                console.log("Welcome Admin!");
                
                loadUsers();
                loadMessages();
                loadRequests(); // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
            } else {
                // â›” Ø´Ø®Øµ Ø¢Ø®Ø± ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                document.body.innerHTML = "<h1 style='text-align:center; margin-top:50px; color:red'>â›” ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø¯Ø®ÙˆÙ„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©!</h1>";
                setTimeout(() => {
                    window.location.href = "index.html"; // Ø·Ø±Ø¯Ù‡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                }, 2000);
            }
        });

        // 1. Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function loadUsers() {
            onValue(ref(db, 'users'), (snapshot) => {
                const table = document.getElementById('users-table');
                const data = snapshot.val();
                table.innerHTML = '';
                if (data) {
                    document.getElementById('user-count').innerText = Object.keys(data).length;
                    Object.values(data).forEach(user => {
                        const row = `<tr><td>${user.name}</td><td>${user.email}</td><td style="font-size:0.8rem">${user.uid}</td><td><button class="btn-delete" onclick="window.deleteUser('${user.uid}')">Ø­Ø°Ù</button></td></tr>`;
                        table.innerHTML += row;
                    });
                }
            });
        }

        // 2. Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function loadMessages() {
            onValue(ref(db, 'public_chat_messages'), (snapshot) => {
                const table = document.getElementById('msgs-table');
                const data = snapshot.val();
                table.innerHTML = '';
                if (data) {
                    const msgs = Object.entries(data).reverse();
                    document.getElementById('msg-count').innerText = msgs.length;
                    msgs.forEach(([key, msg]) => {
                        const content = msg.image ? 'ğŸ“· [ØµÙˆØ±Ø©]' : msg.text;
                        const row = `<tr><td>${msg.senderName}</td><td>${content}</td><td>${msg.time}</td><td><button class="btn-delete" onclick="window.deleteMsg('${key}')">Ø­Ø°Ù</button></td></tr>`;
                        table.innerHTML += row;
                    });
                }
            });
        }

        // 3. Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… (Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
        function loadRequests() {
            onValue(ref(db, 'account_requests'), (snapshot) => {
                const table = document.getElementById('requests-table');
                const data = snapshot.val();
                table.innerHTML = '';
                if (data) {
                    Object.entries(data).forEach(([key, req]) => {
                        const row = `
                            <tr>
                                <td>${req.name}</td>
                                <td>${req.email}</td>
                                <td>${req.reason}</td>
                                <td>${req.date || '-'}</td>
                                <td><button class="btn-delete" style="background:green" onclick="alert('Ø§Ù†Ø³Ø® Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆØ§Ø°Ù‡Ø¨ Ù„ØµÙØ­Ø© Authentication Ù„Ø¥Ø¶Ø§ÙØªÙ‡ ÙŠØ¯ÙˆÙŠØ§Ù‹')">Ù†Ø³Ø® Ù„Ù„Ø¥Ø¶Ø§ÙØ©</button> 
                                    <button class="btn-delete" onclick="window.deleteReq('${key}')">Ø­Ø°Ù</button></td>
                            </tr>`;
                        table.innerHTML += row;
                    });
                } else {
                    table.innerHTML = '<tr><td colspan="5" style="text-align:center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</td></tr>';
                }
            });
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø°Ù
        window.deleteUser = (uid) => { if(confirm('Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) remove(ref(db, 'users/' + uid)); };
        window.deleteMsg = (key) => { if(confirm('Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) remove(ref(db, 'public_chat_messages/' + key)); };
        window.deleteReq = (key) => { if(confirm('Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ')) remove(ref(db, 'account_requests/' + key)); };

    </script>
</body>
</html>